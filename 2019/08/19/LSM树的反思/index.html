<!DOCTYPE html><html><head><meta name="generator" content="Hexo 3.8.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="一些架构设计常接触的思想结构"><meta name="keywords" content><meta name="author" content="zhuyuping"><meta name="copyright" content="zhuyuping"><title>一些架构设计常接触的思想结构 | 朱遇平的github博客</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.6.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.6.0"><link rel="dns-prefetch" href="https://cdn.staticfile.org"><link rel="dns-prefetch" href="https://cdn.bootcss.com"><link rel="dns-prefetch" href="https://creativecommons.org"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  }
} </script></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar"><div class="toggle-sidebar-info text-center"><span data-toggle="Toggle article">Toggle site</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="/img/avatar.png"></div><div class="author-info__name text-center">zhuyuping</div><div class="author-info__description text-center">掌握java相关知识，擅长大数据，以及机器学习算法应用方面 java scala python</div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">19</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">Tags</span><span class="pull-right">4</span></a></div></div></div><div id="content-outer"><div class="no-bg" id="top-container"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">朱遇平的github博客</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus"><a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/categories">Categories</a></span></div><div id="post-info"><div id="post-title">一些架构设计常接触的思想结构</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-08-19</time></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><p>LSM树的反思：<br>最近复习了一下LSM树，发现自己以前认识的不够深刻，从接触NoSQL数据库开始，就不得不接触到LSM结构，从Hbase使用，levelDB等使用，一直觉得LSM是为了在内存排序预先好，比如Hbase 在内存中进行写入LSM树，维持一些key的顺序，然后同时不断的进行三层合并，写入到HFile B+树结构，但是，没有认识到深层次的原因，其实LSM个人认为是一种思想吧，通过合并树，定时在在内存维持着一个有顺序的机构，可以是hashmap可以是红黑树，可以是skiplist，可以使B树，当达到一定阈值时候，不断的与磁盘中的子树进行合并，其实这样做为了写入的性能，能够把随机写，变成有顺序的写，比如内存的LSM的skiplist 可以写入到磁盘中变成一系列有顺序的key 组成的文件列表，最后可以通过compact进行顺序的key区间合并。所以LSM应该是一种思想，牺牲了一定的读性能，是随机写变成了有顺序写，大大提高了磁盘写性能。更方便了后面进行文件的合并。比如leveldb就是这样做的。</p>
<p>Hash的反思：</p>
<p>说起hash结构，作为一种查找/索引的方式，常用的有bitset图思想，有hash查找，有radix查找，有布谷鸟hash等方式，其中我们常用boomfilter布隆过滤器做去重，因为他会误报但是不会漏报，也就是本来存在的一定会判断存在，也有kylin用它来做基数计数统计，为了支持添加删除会用多个位来进行表示相关属性，另外radix 基数，我们用来做前缀 后缀等匹配查找以及计数，正常的hash就是类似我们map方式。通过hash算法比如mumurhash2,然后映射到数组或类似快速查找结构上进行存储，但是因为有利用度不够以及扩容问题，所以有时候要进行rehash扩容处理。对于布谷鸟hash其实有点类似<br>LSH敏感方式，多个k hash方式，获取多个位置，进行链式反应，可以做到很高的空间利用率，但是本质上hash上损失了一定的性能，链式反应以及多个hash过程中。</p>
<p>其实hash不仅仅用于索引查找过程作用，更多时候是实现CAP 的P 进行多副本时候，通常有随机robin取模方式 还有一致性hash方式 还有range区域表管理方式。</p>
<p>一致性hash中，有很多种方式，常用的是DHT的chord类似的方式，一致性hash环，通过映射到环形结构中，顺时针查找相应的节点，如果节点过多，可以每个节点维护一种节点路由表，可以进行2的幂进行查找，logN 时间复杂度 ，查找相应的节点，无论是节点加入还是退出都可以只需要更新重新负载<br>后继节点就可以了，但是这在节点少时候会存在不平衡问题，所以后面就引入了虚拟group概念，减少这种热点不平衡性。</p>
<p>至于说是不是副本一定要用一致性hash是不是一定要用一致性hash这种方式更好呢，不是的，其实range方式也很常用，只需要实现key到partion映射，而partion维护在内存表中动态进行更改分片就行，比如hbase也是这样实现region的，还有hdfs的，多副本一致性，可以采用同步复制，异步复制，<br>混合方式，以及paxso raft方式，或者 NWR机制方式，本质上没有好坏。比如kafka是混合复制方式。但是最新版的开始打算采用raft方式了。</p>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">zhuyuping</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="http://yoursite.com/2019/08/19/LSM树的反思/">http://yoursite.com/2019/08/19/LSM树的反思/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="post-meta__tag-list"></div><nav id="pagination"><div class="prev-post pull-left"><a href="/2019/08/23/选举算法/"><i class="fa fa-chevron-left">  </i><span>有意思的选举算法</span></a></div><div class="next-post pull-right"><a href="/2019/08/02/diststore/"><span>说说自己大数据接触的ES/HBase/TSDB/Redis/Celler</span><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2013 - 2019 By zhuyuping</div><div class="framework-info"><span>Driven - </span><a href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file-o"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.6.0"></script><script src="/js/fancybox.js?version=1.6.0"></script><script src="/js/sidebar.js?version=1.6.0"></script><script src="/js/copy.js?version=1.6.0"></script><script src="/js/fireworks.js?version=1.6.0"></script><script src="/js/transition.js?version=1.6.0"></script><script src="/js/scroll.js?version=1.6.0"></script><script src="/js/head.js?version=1.6.0"></script><script>if(/Android|webOS|iPhone|iPod|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
}</script></body></html>